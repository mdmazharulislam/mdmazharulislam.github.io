{% include base_path %}

{% if post.header.teaser %}
  {% capture teaser %}{{ post.header.teaser }}{% endcapture %}
{% else %}
  {% assign teaser = site.teaser %}
{% endif %}

{% if post.id %}
  {% assign title = post.title | markdownify | remove: "<p>" | remove: "</p>" %}
{% else %}
  {% assign title = post.title %}
{% endif %}

<div class="{{ include.type | default: "list" }}__item">
  <article class="archive__item" itemscope itemtype="http://schema.org/CreativeWork">

    {% assign id = post.url | slugify %}

    {% if include.type == "grid" and teaser %}
      <div class="archive__item-teaser">
        <img src=
          {% if teaser contains "://" %}
            "{{ teaser }}"
          {% else %}
            "{{ teaser | prepend: "/images/" | prepend: base_path }}"
          {% endif %}
          alt="">
      </div>
    {% endif %}


<!-- Title -->
<h2 class="archive__item-title">

  {% if include.type == "journal" %}
    <span style="color:#585858; font-weight:bold;">[J{{ include.number }}]</span>
  {% elsif include.type == "conference" %}
    <span style="color:#585858; font-weight:bold;">[C{{ include.number }}]</span>
  {% elsif include.type == "thesis" %}
    <span style="color:#585858; font-weight:bold;">[T{{ include.number }}]</span>
  {% endif %}

  <a href="{{ base_path }}{{ post.url }}">
    {{ post.title }}
  </a>

</h2>


<!-- Authors -->
{% if post.authors %}
<p class="archive__item-authors">
  <strong>Authors:</strong>
  {{ post.authors
    | replace: "Md. Mazharul Islam", "<strong style='color:#000;'>Md. Mazharul Islam</strong>"
  }}
</p>
{% endif %}

<!-- Supervisor -->
{% if post.supervisor %}
<p class="archive__item-authors">
  <strong>Supervisor:</strong>
  {% if post.supervisor_url %}
    <a href="{{ post.supervisor_url }}" target="_blank"><strong>{{ post.supervisor }}</strong></a>
  {% else %}
    <strong>{{ post.supervisor }}</strong>
  {% endif %}
</p>
{% endif %}


<!-- Venue, Year, Status -->
{% if post.collection == 'publications' %}
<p>

  {% if post.venue %}
    <i>{{ post.venue }}</i>,
  {% endif %}

  {{ post.date | date: "%Y" }}

  {% if post.location %}
    <br><i style="color:#666;">üìç {{ post.location }}</i>
  {% endif %}

  {% if post.status %}
    <br>
    {% if post.status == "Published" %}
      <span style="display:inline-block; margin-top:4px; padding:2px 10px; border-radius:20px; font-size:0.78em; font-weight:600; background-color:#d4edda; color:#155724; border:1px solid #c3e6cb;">
        ‚úì Published
      </span>
    {% elsif post.status == "Under Review" %}
      <span style="display:inline-block; margin-top:4px; padding:2px 10px; border-radius:20px; font-size:0.78em; font-weight:600; background-color:#fff3cd; color:#856404; border:1px solid #ffeeba;">
        ‚è≥ Under Review
      </span>
    {% elsif post.status == "Accepted" %}
      <span style="display:inline-block; margin-top:4px; padding:2px 10px; border-radius:20px; font-size:0.78em; font-weight:600; background-color:#cce5ff; color:#004085; border:1px solid #b8daff;">
        ‚úì Accepted
      </span>
    {% elsif post.status == "Accepted and Presented" %}
      <span style="display:inline-block; margin-top:4px; padding:2px 10px; border-radius:20px; font-size:0.78em; font-weight:600; background-color:#d1ecf1; color:#0c5460; border:1px solid #bee5eb;">
        ‚úì Accepted and Presented
      </span>
    {% elsif post.status == "Master's Thesis" %}
    <span style="display:inline-block; margin-top:4px; padding:2px 10px; border-radius:20px; font-size:0.78em; font-weight:600; background-color:#e8d5f5; color:#5a2d82; border:1px solid #d4a8f0;">
      üéì Master's Thesis
    </span>
    {% else %}
      <span style="display:inline-block; margin-top:4px; padding:2px 10px; border-radius:20px; font-size:0.78em; font-weight:600; background-color:#e2e3e5; color:#383d41; border:1px solid #d6d8db;">
        {{ post.status }}
      </span>
    {% endif %}
  {% endif %}

</p>
{% endif %}


<!-- Links Section -->
{% if post.collection == 'publications' %}
<p>

  {% assign has_link = false %}

  {% if post.journalurl %}
    <a href="{{ post.journalurl }}" target="_blank">{{ include.link_label | default: "DOI" }}</a>
    {% assign has_link = true %}
  {% endif %}

  {% if post.confurl %}
  <a href="{{ post.confurl }}" target="_blank">Conference Page</a>
  {% assign has_link = true %}
  {% endif %}

  {% if post.paperurl %}
    {% if has_link %} | {% endif %}
    <a href="{{ post.paperurl }}" target="_blank">PDF</a>
    {% assign has_link = true %}
  {% endif %}

  {% if post.citation %}
    {% if has_link %} | {% endif %}
    <a href="javascript:void(0);"
       onclick="toggleBox('citation-{{ post.url | slugify }}')">
      Citation
    </a>
    {% assign has_link = true %}
  {% endif %}

  {% if post.bibtex %}
    {% if has_link %} | {% endif %}
    <a href="javascript:void(0);"
       onclick="toggleBox('bibtex-{{ post.url | slugify }}')">
      BibTeX
    </a>
  {% endif %}

</p>
{% endif %}


<!-- Citation Popup -->
{% if post.citation %}
<div id="citation-{{ post.url | slugify }}" class="popup-box" style="display:none; margin-top:10px; background-color:#f8f9fa; border-left:4px solid #4a90d9; padding:12px 16px; border-radius:4px;">
  <pre id="citation-text-{{ post.url | slugify }}" style="margin:0 0 10px 0; white-space:pre-wrap; font-size:0.85em;">{{ post.citation | escape }}</pre>
  <button data-copy="citation-text-{{ post.url | slugify }}"
          onclick="copyText('citation-text-{{ post.url | slugify }}')"
          class="btn btn--primary btn--small">
    Copy Citation
  </button>
</div>
{% endif %}


<!-- BibTeX Popup -->
{% if post.bibtex %}
<div id="bibtex-{{ post.url | slugify }}" class="popup-box" style="display:none; margin-top:10px; background-color:#f8f9fa; border-left:4px solid #4a90d9; padding:12px 16px; border-radius:4px;">
  <pre id="bibtex-text-{{ post.url | slugify }}" style="margin:0 0 10px 0; white-space:pre-wrap; font-size:0.85em;">{{ post.bibtex | escape }}</pre>
  <button data-copy="bibtex-text-{{ post.url | slugify }}"
          onclick="copyText('bibtex-text-{{ post.url | slugify }}')"
          class="btn btn--primary btn--small">
    Copy BibTeX
  </button>
</div>
{% endif %}


<!-- Description -->
{% if post.content %}
<div class="archive__item-excerpt" style="margin-top:10px;">
  {{ post.content }}
</div>
{% endif %}


</article>
</div>


<script>
function toggleBox(id) {
  var el = document.getElementById(id);
  if (!el) {
    console.log("Element not found: " + id);
    return;
  }
  el.style.display = el.style.display === "block" ? "none" : "block";
}

function copyText(id) {
  var textEl = document.getElementById(id);
  if (!textEl) return;
  navigator.clipboard.writeText(textEl.innerText).then(function() {
    var btn = document.querySelector('[data-copy="' + id + '"]');
    if (!btn) return;
    var original = btn.innerText;
    var originalBg = btn.style.backgroundColor;
    var originalBorder = btn.style.borderColor;

    btn.innerText = "Copied ‚úì";
    btn.style.backgroundColor = "#28a745";
    btn.style.borderColor = "#28a745";
    btn.style.color = "#fff";

    setTimeout(function() {
      btn.innerText = original;
      btn.style.backgroundColor = originalBg;
      btn.style.borderColor = originalBorder;
      btn.style.color = "";
    }, 1500);
  });
}
</script>